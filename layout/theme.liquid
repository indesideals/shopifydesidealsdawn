{% comment %}
  CLEAN THEME LAYOUT - OPTIMIZED FOR MOBILE/DESKTOP SEPARATION
{% endcomment %}

{% comment %} Device Detection {% endcomment %}
{% assign device_param = request.url | split: 'device=' | last | split: '&' | first %}
{% assign force_mobile = device_param == 'mobile' %}
{% assign force_desktop = device_param == 'desktop' %}

{% assign user_agent = request.user_agent | downcase %}
{% assign is_mobile_agent = false %}

{% if user_agent contains 'mobile' or user_agent contains 'android' or user_agent contains 'iphone' or user_agent contains 'ipad' or user_agent contains 'ipod' or user_agent contains 'blackberry' or user_agent contains 'iemobile' or user_agent contains 'opera mini' or user_agent contains 'webos' or user_agent contains 'tablet' or user_agent contains 'phone' %}
  {% assign is_mobile_agent = true %}
{% endif %}

{% assign is_mobile = force_mobile or is_mobile_agent %}

<!DOCTYPE html>
<html lang="{{ request.locale.iso_code }}">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#6366f1">
  <link rel="canonical" href="{{ canonical_url }}">
  
  <link rel="icon" type="image/svg+xml" href="{{ 'favicon.svg' | asset_url }}">
  <link rel="manifest" href="{{ 'site.webmanifest' | asset_url }}">
  
  <title>
    {{ page_title }}
    {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
    {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
    {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
  </title>

  {% if page_description %}
    <meta name="description" content="{{ page_description | escape }}">
  {% endif %}

  {{ content_for_header }}

  <!-- Load CSS based on device -->
  {{ 'base.css' | asset_url | stylesheet_tag }}
  {% if is_mobile %}
    {{ 'mobile.css' | asset_url | stylesheet_tag }}
  {% else %}
    {{ 'desktop.css' | asset_url | stylesheet_tag }}
  {% endif %}

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="{% if is_mobile %}mobile-experience{% else %}desktop-experience{% endif %}" data-theme-type="{% if is_mobile %}mobile{% else %}desktop{% endif %}">
  
  {% if is_mobile %}
    {% render 'mobile-layout' %}
  {% else %}
    {% render 'desktop-layout' %}
  {% endif %}

  <!-- Main Content -->
  <main>
    {{ content_for_layout }}
  </main>

  <!-- Footer -->
  {% unless is_mobile %}
    {% section 'footer' %}
  {% endunless %}

  <!-- Load JavaScript based on device -->
  {% if is_mobile %}
    {{ 'mobile.js' | asset_url | script_tag }}
  {% else %}
    {{ 'desktop.js' | asset_url | script_tag }}
  {% endif %}

  <!-- Global Functions -->
  <script>
    // Add to cart function
    function addToCartDirect(productId, variantId, title, price, image, url) {
      console.log('addToCartDirect called:', { productId, variantId, title, price, image, url });
      
      if (document.body.classList.contains('mobile-experience')) {
        if (window.addToMobileCart) {
          window.addToMobileCart(productId, variantId, title, price, image, url);
        } else {
          console.error('Mobile cart system not ready');
        }
      } else {
        if (window.addToDesktopCart) {
          window.addToDesktopCart(productId, variantId, title, price, image, url);
        } else {
          console.error('Desktop cart system not ready');
        }
      }
    }

    // Search function
    function toggleSearch() {
      if (window.toggleSearch) {
        window.toggleSearch();
      }
    }

    // Burger menu functions
    function toggleBurgerMenu() {
      if (window.toggleBurgerMenu) {
        window.toggleBurgerMenu();
      }
    }

    function closeBurgerMenu() {
      if (window.closeBurgerMenu) {
        window.closeBurgerMenu();
      }
    }

    // Cart functions
    function openDesktopCart() {
      if (window.openDesktopCart) {
        window.openDesktopCart();
      }
    }
  </script>

</body>
</html>
