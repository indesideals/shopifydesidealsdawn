{% comment %}
  Product Rating Snippet
  Generates consistent star ratings and review counts based on product ID
  Usage: {% render 'product-rating', product: product, rating: manual_rating, review_count: manual_review_count %}
{% endcomment %}

{% if rating != blank %}
  {% assign final_rating = rating %}
{% else %}
  {%- comment -%}
    First, try per-product overrides so collection and PDP stay in sync.
  {%- endcomment -%}
  {% case product.handle %}
    {% when 'oil-dispenser-silicone-brush-250ml' %}
      {% assign final_rating = 4.6 %}
    {% when 'mini-sink-strainer-basket' %}
      {% assign final_rating = 4.5 %}
    {% when 'rotating-multipurpose-hook-hanger' %}
      {% assign final_rating = 4.5 %}
    {% when 'vegetable-cleaning-brush' %}
      {% assign final_rating = 4.7 %}
    {% when 'electric-handheld-vegetable-cutter' %}
      {% assign final_rating = 4.9 %}
    {% when 'mini-hand-press-chopper-3-blade' %}
      {% assign final_rating = 4.6 %}
    {% when 'pink-flamingo-led-table-lamp' %}
      {% assign final_rating = 4.7 %}
    {% when 'pink-flamingo-led-night-light' %}
      {% assign final_rating = 4.7 %}
    {% when 'stainless-steel-bowl-colander-grater-4-in-1' %}
      {% assign final_rating = 4.7 %}
    {% when 'heart-grater-slicer-set-4pc' %}
      {% assign final_rating = 4.4 %}
    {% when 'led-angel-night-light' %}
      {% assign final_rating = 4.6 %}
    {% when 'mini-garment-steamer' %}
      {% assign final_rating = 4.4 %}
    {% when 'mini-hand-press-chopper-3-blade' %}
      {% assign final_rating = 4.3 %}
    {% when 'vegetable-cleaning-brush' %}
      {% assign final_rating = 4.8 %}
    {% when 'mini-sink-strainer-basket' %}
      {% assign final_rating = 4.7 %}
    {% else %}
      {% assign final_rating = blank %}
  {% endcase %}

  {% if final_rating == blank %}
    {% assign product_title_lc = product.title | downcase %}
    {% if product_title_lc contains 'electric handheld vegetable cutter' or product_title_lc contains 'handheld vegetable cutter' or product_title_lc contains 'electric garlic chopper' or product_title_lc contains 'mini chopper' %}
      {% assign final_rating = 4.6 %}
    {% endif %}
  {% endif %}

  {% if final_rating == blank %}
    {% assign product_id = product.id | modulo: 1000 %}
    {% assign rating_seed = product_id | plus: 100 %}
    {% comment %} Generate consistent rating between 4.5 and 4.8 {% endcomment %}
    {% assign rating_base = rating_seed | modulo: 4 %}
    {% case rating_base %}
      {% when 0 %}
        {% assign final_rating = 4.5 %}
      {% when 1 %}
        {% assign final_rating = 4.6 %}
      {% when 2 %}
        {% assign final_rating = 4.7 %}
      {% when 3 %}
        {% assign final_rating = 4.8 %}
    {% endcase %}
  {% endif %}
{% endif %}

{% if review_count != blank %}
  {% assign final_review_count = review_count %}
{% else %}
  {%- comment -%}
    Per-product review counts, falling back to seeded values
  {%- endcomment -%}
  {% case product.handle %}
    {% when 'oil-dispenser-silicone-brush-250ml' %}
      {% assign final_review_count = 2453 %}
    {% when 'mini-sink-strainer-basket' %}
      {% assign final_review_count = 2968 %}
    {% when 'rotating-multipurpose-hook-hanger' %}
      {% assign final_review_count = 2983 %}
    {% when 'vegetable-cleaning-brush' %}
      {% assign final_review_count = 1856 %}
    {% when 'electric-handheld-vegetable-cutter' %}
      {% assign final_review_count = 2109 %}
    {% when 'mini-hand-press-chopper-3-blade' %}
      {% assign final_review_count = 2453 %}
    {% when 'pink-flamingo-led-table-lamp' %}
      {% assign final_review_count = 2398 %}
    {% when 'pink-flamingo-led-night-light' %}
      {% assign final_review_count = 2398 %}
    {% when 'stainless-steel-bowl-colander-grater-4-in-1' %}
      {% assign final_review_count = 3110 %}
    {% when 'heart-grater-slicer-set-4pc' %}
      {% assign final_review_count = 2986 %}
    {% when 'led-angel-night-light' %}
      {% assign final_review_count = 3109 %}
    {% when 'mini-garment-steamer' %}
      {% assign final_review_count = 2876 %}
    {% when 'mini-hand-press-chopper-3-blade' %}
      {% assign final_review_count = 4122 %}
    {% when 'vegetable-cleaning-brush' %}
      {% assign final_review_count = 3221 %}
    {% when 'mini-sink-strainer-basket' %}
      {% assign final_review_count = 3782 %}
    {% else %}
      {% assign final_review_count = blank %}
  {% endcase %}

  {% if final_review_count == blank %}
    {% assign product_title_lc = product.title | downcase %}
    {% if product_title_lc contains 'electric handheld vegetable cutter' or product_title_lc contains 'handheld vegetable cutter' or product_title_lc contains 'electric garlic chopper' or product_title_lc contains 'mini chopper' %}
      {% assign final_review_count = 2453 %}
    {% endif %}
  {% endif %}

  {% if final_review_count == blank %}
    {% assign product_id = product.id | modulo: 1000 %}
    {% assign review_seed = product_id | plus: 200 %}
    {% assign final_review_count = review_seed | modulo: 3500 | plus: 2500 %}
  {% endif %}
{% endif %}

{% comment %} Calculate stars display {% endcomment %}
{% assign full_stars = final_rating | floor %}
{% assign decimal_part = final_rating | modulo: 1 | round: 1 %}
{% assign has_partial_star = decimal_part | at_least: 0.1 %}
{% assign partial_star_position = full_stars | plus: 1 %}

<div class="product-rating">
  <div class="stars">
    {% for i in (1..5) %}
      {% if i <= full_stars %}
        <span class="star filled">★</span>
      {% elsif has_partial_star and i == partial_star_position %}
        <span class="star partial" style="background: linear-gradient(90deg, #fbbf24 {{ decimal_part | times: 100 }}%, #d1d5db {{ decimal_part | times: 100 }}%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: #fbbf24 !important;">★</span>
      {% else %}
        <span class="star">★</span>
      {% endif %}
    {% endfor %}
  </div>
  <span class="rating-text">{{ final_rating }} stars</span>
  <span class="reviews-text">({{ final_review_count | round }} reviews)</span>
</div> 